<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تواصل معنا</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }

        .tab-active {
            @apply border-b-2 border-pink-500 text-pink-600 font-bold;
            transition: all 0.3s ease;
        }

        #chat-tab, #contact-tab {
            transition: opacity 0.3s ease-in-out;
        }

        button {
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        button:hover {
            background-color: #ec4899;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.98);
        }

    </style>
</head>
<body class="bg-gray-100">

    {% include 'clinic/navbar.html' %}

    <div class="max-w-3xl mx-auto mt-10">
        <div class="flex justify-center space-x-4 rtl:space-x-reverse mb-4 border-b">
            <button onclick="showTab('chat-tab')" id="chat-tab-btn" class="py-2 px-4 text-lg hover:text-pink-500">📨 دردش معنا</button>
            <button onclick="showTab('contact-tab')" id="contact-tab-btn" class="py-2 px-4 text-lg hover:text-pink-500">📝 اتصل بنا</button>
        </div>

        <!-- دردش معنا -->
        <div id="chat-tab" class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex items-center justify-center mb-4 gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-pink-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2c-2.76 0-5 2.24-5 5 0 .65.13 1.27.35 1.84-.3.25-.57.53-.8.84C5.3 10.51 5 11.71 5 13v6c0 .55.45 1 1 1s1-.45 1-1v-6c0-.89.39-1.69 1-2.25.61.56 1.41.95 2.3 1.08l.4.05.29-.26C11.58 11.11 12 10.1 12 9c0-1.1-.42-2.11-1.1-2.87C11.56 5.13 12.75 4 14 4c1.66 0 3 1.34 3 3 0 1.64-1.18 3.01-2.7 3.39l-.7.16-.17.7c-.11.47-.25.94-.41 1.4-.2.57-.42 1.12-.66 1.65l-.21.43-.15.29c-.21.42-.43.82-.66 1.22-.46.82-1.2 1.44-2.14 1.44H10c-.55 0-1 .45-1 1s.45 1 1 1h.05c1.69 0 3.18-1.02 3.95-2.51.27-.54.52-1.1.75-1.66.26-.63.49-1.28.69-1.93.25-.83.46-1.69.6-2.55"/>
                </svg>
                <h2 class="text-2xl font-bold text-blue-900">دردش معنا</h2>
            </div>
            <div class="h-[400px] flex flex-col">
                <div id="chat-box" class="flex-1 overflow-y-auto space-y-4 pr-2 mb-4"></div>
                <div class="flex gap-2">
                    <textarea id="user-input" rows="1" placeholder="اكتب رسالتك..." class="flex-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 text-right resize-none"></textarea>
                    <button id="send-btn" class="bg-pink-500 text-white px-5 py-2 rounded-md shadow hover:bg-pink-600">إرسال</button>
                </div>
            </div>
        </div>

        <!-- اتصل بنا -->
        <div id="contact-tab" class="hidden bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-blue-900 text-center mb-4">نموذج التواصل</h2>
            <form action="/send_inquiry" method="post">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="name" class="block text-sm font-medium text-gray-700 text-right">:الإسم</label>
                    <input type="text" id="name" name="name" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 text-right">
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 text-right">:الإيميل</label>
                    <input type="email" id="email" name="email" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 text-right">
                </div>
                <div class="mb-4">
                    <label for="message" class="block text-sm font-medium text-gray-700 text-right">:الرسالة</label>
                    <textarea id="message" name="message" rows="5" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 text-right"></textarea>
                </div>
                <button type="submit" class="w-full bg-pink-400 text-white py-3 rounded-md hover:bg-pink-500 focus:ring-2 focus:ring-blue-500">إرسال</button>
            </form>
        </div>
    </div>

    {% include 'clinic/footer.html' %}

    <script>
        // Tabs Switching Logic
        function showTab(tabId) {
            document.getElementById('chat-tab').classList.add('hidden');
            document.getElementById('contact-tab').classList.add('hidden');
            document.getElementById(tabId).classList.remove('hidden');
            document.getElementById(tabId).classList.add('transition-opacity duration-500 opacity-100');

            document.getElementById('chat-tab-btn').classList.remove('tab-active');
            document.getElementById('contact-tab-btn').classList.remove('tab-active');
            document.getElementById(tabId + '-btn').classList.add('tab-active');
        }

        // Chat functionality
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        sendBtn.addEventListener('click', () => {
            const message = userInput.value.trim();
            if (message === '') {
                alert('يرجى كتابة رسالة قبل الإرسال');
                return;
            }

            chatBox.innerHTML += `<div class="text-right"><div class="inline-block bg-blue-100 px-4 py-2 rounded-lg">${message} <span>🙂</span></div></div>`;
            userInput.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            // إضافة إشعار بعد الإرسال
            const notification = document.createElement('div');
            notification.classList.add('text-center', 'bg-green-200', 'p-2', 'rounded-lg', 'my-2');
            notification.textContent = 'تم إرسال الرسالة بنجاح!';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);  // اختفاء الإشعار بعد 3 ثواني

            fetch('/chat/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: 'user_input=' + encodeURIComponent(message)
            })
            .then(res => res.json())
            .then(data => {
                if (data.response) {
                    chatBox.innerHTML += `<div class="text-left"><div class="inline-block bg-gray-100 px-4 py-2 rounded-lg">${data.response}</div></div>`;
                } else {
                    chatBox.innerHTML += `<div class="text-left"><div class="inline-block bg-red-200 px-4 py-2 rounded-lg">حدث خطأ: ${data.error}</div></div>`;
                }
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        });

        userInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                sendBtn.click();
            }
        });

        // تفعيل التبويب الأول تلقائيًا
        showTab('chat-tab');
    </script>
</body>
</html>
